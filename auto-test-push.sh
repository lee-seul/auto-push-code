#!/bin/zsh


echo ""
echo ""
echo "######################################################################################################"
echo "########################################### Run Test #################################################"
echo "######################################################################################################"
echo ""
echo ""

python3 -m pytest --cov=.

if [  "$?" = "0" ]; then
    echo ""
    echo ""
    echo "######################################################################################################"
    echo "########################################### Git push #################################################"
    echo "######################################################################################################"
    echo ""
    echo ""
    
    MESSAGE="$1"
    if [ $1 = '' ]; then
        MESSAGE="auto commit and push"
    fi 

    git add .
    git commit -am "$MESSAGE"
    git push 

else
    echo ""
    echo ""
    echo "########################################### Test fail ################################################"
    echo ""
    echo ""

    ./auto-repo-change-check.sh
fi

./auto-repo-change-check.sh
